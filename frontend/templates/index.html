<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Spotify Track Search</title>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="32x32" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="16x16" href="/static/favicon.ico">
    <style>
        body {
            background: linear-gradient(to bottom, #070707, #1a1a1a);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            color: #ffffff;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        img {
            width: 7vw;
            height: auto;
            margin-bottom: 3vh;
        }

        img {
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .grid-item.m-5 {
            background-color: #222222;
            overflow-y: scroll;
            height: 40vh;
            padding: 15px;
        }

        .grid-item.m-5::-webkit-scrollbar {
            width: 8px;
        }

        .grid-item.m-5::-webkit-scrollbar-track {
            background: #222222;
        }

        .grid-item.m-5::-webkit-scrollbar-thumb {
            background: #e6e6e6;
            border-radius: 4px;
        }

        .grid-item.m-5::-webkit-scrollbar-thumb:hover {
            background: #1ed760;
        }

        .favBtn {
            background-color: #1ed760;
            color: black;
            font-size: 20px !important;
        }
    </style>

</head>

<body class="min-h-screen flex justify-center pt-20 text-white">
    <div class="text-center  w-full">

        <div class="grid grid-cols-2">
            <div class="grid-item col-span-2">
                <center>
                    <img class="p-3" src="/static/SpotifySearchLogo.png" alt="SpotifySearcher Logo">
                </center>
            </div>
            <div class="m-5 grid-item">


                <h3 class="text-2xl font-bold mb-4">Search Spotify Tracks</h3>

                <input type="text" name="q" placeholder="Search by track or artistâ€¦"
                    class="w-4/5 p-2 border border-gray-300 rounded-xl mb-4 text-black" hx-get="/search"
                    hx-trigger="keyup changed delay:300ms" hx-target="#results" hx-swap="innerHTML">

                <div id="results" class="space-y-2 mb-8">
                    <!-- Search results will appear here -->
                </div>
            </div>
            <div class="m-5 grid-item">

                <h2 class="text-xl font-semibold mb-2">Favorites</h2>
                <h4> Max of 100 songs! </h4>
                <ul id="favorites" class="space-y-1 text-green-200">
                    <!-- Favorites will appear here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('submit', function (e) {
            if (e.target.matches('form[data-favorite]')) {
                e.preventDefault(); // stop actual submission

                const track = e.target.dataset.track;
                const artist = e.target.dataset.artist;
                const song = `${track} - ${artist}`;
                const list = document.getElementById('favorites');

                if ([...list.children].some(li => li.textContent === song)) return;

                const li = document.createElement('li');
                li.textContent = song;
                list.appendChild(li);

                // Submit form via fetch
                fetch('/add_favorite', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ track, artist })
                });
            }
        });

    </script>
</body>

</html>