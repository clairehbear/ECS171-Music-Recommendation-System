<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Spotify Track Search</title>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex justify-center pt-20 bg-green-950 text-white">
    <div class="text-center max-w-2xl w-full">
        <h1 class="text-2xl font-bold mb-4">Search Spotify Tracks</h1>

        <input type="text" name="q" placeholder="Search by track or artistâ€¦"
            class="w-4/5 p-2 border border-gray-300 rounded-xl mb-4 text-black"
            hx-get="/search" hx-trigger="keyup changed delay:300ms" 
            hx-target="#results" hx-swap="innerHTML">

        <div id="results" class="space-y-2 mb-8">
            <!-- Search results will appear here -->
        </div>

        <h2 class="text-xl font-semibold mb-2">Favorites</h2>
        <ul id="favorites" class="space-y-1 text-green-200">
            <!-- Favorites will appear here -->
        </ul>
    </div>

    <script>
        document.addEventListener('submit', function (e) {
            if (e.target.matches('form[data-favorite]')) {
                e.preventDefault(); // stop actual submission

                const track = e.target.dataset.track;
                const artist = e.target.dataset.artist;
                const song = `${track} - ${artist}`;
                const list = document.getElementById('favorites');

                if ([...list.children].some(li => li.textContent === song)) return;

                const li = document.createElement('li');
                li.textContent = song;
                list.appendChild(li);

                // Submit form via fetch
                fetch('/add_favorite', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ track, artist })
                });
            }
        });
    </script>
</body>

</html>
